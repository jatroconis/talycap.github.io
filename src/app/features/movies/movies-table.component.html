
<mat-card>
  <div class="toolbar">
    <mat-form-field appearance="outline" class="search">
      <mat-label>Buscar película</mat-label>
      <input matInput [formControl]="searchCtrl" placeholder="Ej. Inception" />
      @if (searchCtrl.value) {
        <button mat-icon-button matSuffix aria-label="Limpiar" (click)="searchCtrl.setValue('')">
          <mat-icon>close</mat-icon>
        </button>
      }
    </mat-form-field>
  </div>

  <div class="table-wrap">
    @if (loading()) {
      <div class="center">
        <mat-progress-spinner mode="indeterminate"></mat-progress-spinner>
      </div>
    }

    @if (vm$ | async; as vm) {
      <table mat-table [dataSource]="vm.items" class="mat-elevation-z1">

        <!-- Poster -->
        <ng-container matColumnDef="poster">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let m">
            @if (m.posterUrl) {
            <img [src]="imgUrl(m.posterUrl)" [alt]="posterAlt(m.title)" width="40" height="60" loading="lazy" />
            } @else {
            <mat-icon aria-hidden="true">image_not_supported</mat-icon>
            }
          </td>
        </ng-container>

        <!-- Título -->
        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef>Título</th>
          <td mat-cell *matCellDef="let m">{{ m.title }}</td>
        </ng-container>

        <!-- Fecha -->
        <ng-container matColumnDef="releaseDate">
          <th mat-header-cell *matHeaderCellDef>Estreno</th>
          <td mat-cell *matCellDef="let m">{{ m.releaseDate | date }}</td>
        </ng-container>

        <!-- Rating -->
        <ng-container matColumnDef="voteAverage">
          <th mat-header-cell *matHeaderCellDef>Rating</th>
          <td mat-cell *matCellDef="let m">{{ m.voteAverage | number:'1.1-1' }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>

      <mat-paginator
        [length]="vm.total"
        [pageIndex]="vm.page - 1"
        [pageSize]="20"
        [pageSizeOptions]="[10,20,50]"
        (page)="onPage($event)">
      </mat-paginator>
    }
  </div>
</mat-card>
